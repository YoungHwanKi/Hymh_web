<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title th:text="${title} ?: 'Home'">Home</title>

    <link th:href="@{/css/mainFrame.css}" rel="stylesheet">
    <link th:href="@{/css/memo.css}" rel="stylesheet">
</head>

<body>

<!-- ✅ TOP 영역 -->
<header class="topbar">
    <!-- 모바일 메뉴 버튼 -->
    <button class="menu-btn" onclick="toggleSidebar()">☰</button>

    <a href="/main" class="logo">
        <img th:src="@{/images/home/logo.png}" alt="Logo"/>
        <span>Hymh Web</span>
    </a>

    <div class="user-info" th:if="${session.user != null}">
        <span th:text="${session.user.getYname() + ' 님'}"></span>
        <a href="/logout" class="logout-btn">Logout</a>
    </div>
</header>


<!-- ✅ 본문 전체 -->
<div class="container">

    <!-- ✅ LEFT Sidebar -->
    <nav id="sidebar" class="sidebar">
        <ul class="menu">

            <li class="menu-parent">
                <span class="parent-title">DashBoard</span>
                <ul class="submenu">
                    <li><a href="/main">메인</a></li>
                </ul>
            </li>

            <li class="menu-parent">
                <span class="parent-title">메모 관리</span>
                <ul class="submenu">
                    <li><a href="/memo">기록장</a></li>
                </ul>
            </li>

            <li class="menu-parent">
                <span class="parent-title">로그 관리</span>
                <ul class="submenu">
                    <li><a href="/log">로그 조회</a></li>
                    <li><a href="/log/stat">통계</a></li>
                </ul>
            </li>

            <li class="menu-parent">
                <span class="parent-title">게시판</span>
                <ul class="submenu">
                    <li><a href="/board">게시판 메인</a></li>
                    <li><a href="/board/free">자유게시판</a></li>
                    <li><a href="/board/notice">공지사항</a></li>
                </ul>
            </li>

        </ul>
    </nav>


    <!-- ✅ 오른쪽 본문 (fragment 삽입 영역) -->
    <main class="main-content">
        <div th:insert="~{${tpl} :: ${frag}}"></div>
    </main>


</div>


<script>
    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
    }


    // ▣ 기능 1: 상위 메뉴 클릭 시 다른 메뉴 닫고, 클릭한 메뉴만 열리는 아코디언
    document.querySelectorAll(".parent-title").forEach(parent => {
        parent.addEventListener("click", () => {
            const submenu = parent.nextElementSibling;
            const isOpen = submenu.style.display === "block";

            // 모든 메뉴 닫기
            document.querySelectorAll(".submenu").forEach(m => m.style.display = "none");
            document.querySelectorAll(".parent-title").forEach(t => t.classList.remove("active"));

            // 클릭한 메뉴 열기
            if (!isOpen) {
                submenu.style.display = "block";
                parent.classList.add("active");
            }
        });
    });


    // ▣ 기능 2: 현재 URL의 메뉴 활성화 + 상위 카테고리 자동 Open
    const currentPath = window.location.pathname;

    document.querySelectorAll(".submenu li a").forEach(link => {
        if (link.getAttribute("href") === currentPath) {

            // (1) 현재 메뉴에 active 적용
            link.classList.add("active");

            // (2) 상위 submenu 열기
            const submenu = link.closest(".submenu");
            submenu.style.display = "block";

            // (3) 상위 메뉴 active 표시
            const parentTitle = submenu.previousElementSibling;
            parentTitle.classList.add("active");
        }
    });
</script>

</body>
</html>